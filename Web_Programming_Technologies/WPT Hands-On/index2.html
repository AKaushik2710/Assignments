<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Product Feedback Form</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body {
      background-color: #f8f9fa;
    }
    .feedback-card {
      max-width: 600px;
      margin: 40px auto;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border-radius: 15px;
    }
    .star-rating i {
      font-size: 1.8rem;
      color: #ddd;
      cursor: pointer;
    }
    .star-rating i.active {
      color: #fbc02d;
    }
    .char-count {
      font-size: 0.9rem;
      color: #6c757d;
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card feedback-card">
      <div class="card-body">
        <h3 class="card-title text-center mb-4">Product Feedback</h3>

        <div id="alertContainer"></div>

        <form id="feedbackForm" novalidate>
          <div class="mb-3">
            <label for="fullName" class="form-label">Full Name</label>
            <input
              type="text"
              id="fullName"
              class="form-control"
              placeholder="Enter your full name"
            />
            <div class="text-danger small" id="nameError"></div>
          </div>

          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input
              type="email"
              id="email"
              class="form-control"
              placeholder="Enter your email"
            />
            <div class="text-danger small" id="emailError"></div>
          </div>

          <div class="mb-3">
            <label for="category" class="form-label">Product Category</label>
            <select id="category" class="form-select">
              <option value="">Select category</option>
              <option value="Electronics">Electronics</option>
              <option value="Fashion">Fashion</option>
              <option value="Grocery">Grocery</option>
            </select>
            <div class="text-danger small" id="categoryError"></div>
          </div>

          <div class="mb-3">
            <label class="form-label">Rating</label>
            <div class="star-rating" id="starRating">
              <i class="bi bi-star" data-value="1"></i>
              <i class="bi bi-star" data-value="2"></i>
              <i class="bi bi-star" data-value="3"></i>
              <i class="bi bi-star" data-value="4"></i>
              <i class="bi bi-star" data-value="5"></i>
            </div>
            <div class="text-danger small" id="ratingError"></div>
          </div>

          <div class="mb-3">
            <label for="feedback" class="form-label">Feedback</label>
            <textarea
              id="feedback"
              class="form-control"
              rows="4"
              placeholder="Write your feedback (at least 30 characters)"
            ></textarea>
            <div class="char-count" id="charCount">0 / 500</div>
            <div class="text-danger small" id="feedbackError"></div>
          </div>

          <button type="submit" class="btn btn-primary w-100">Submit</button>
        </form>
      </div>
    </div>
  </div>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"/>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
  const form = document.getElementById("feedbackForm");
  const stars = document.querySelectorAll("#starRating i");
  const alertContainer = document.getElementById("alertContainer");
  let selectedRating = 0;

  // Star click functionality
  stars.forEach((star) => {
    star.addEventListener("click", () => {
      selectedRating = Number(star.getAttribute("data-value")); // <- Number() here
      stars.forEach((s, index) => {
        // toggle active class for first `selectedRating` stars
        s.classList.toggle("active", index < selectedRating);
      });
    });
  });

  // Live character count
  const feedback = document.getElementById("feedback");
  const charCount = document.getElementById("charCount");
  feedback.addEventListener("input", () => {
    const len = feedback.value.length;
    charCount.textContent = len + " / 500";
  });

  // Correct email regex
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  // Validation on submit
  form.addEventListener("submit", function (e) {
    e.preventDefault();

    let isValid = true;
    const name = document.getElementById("fullName").value.trim();
    const email = document.getElementById("email").value.trim();
    const category = document.getElementById("category").value;
    const feedbackText = feedback.value.trim();

    document.querySelectorAll(".text-danger").forEach((el) => (el.textContent = ""));
    alertContainer.innerHTML = ""; // clear prior alerts

    if (name === "") {
      document.getElementById("nameError").textContent = "Name is required";
      isValid = false;
    }

    if (email === "") {
      document.getElementById("emailError").textContent = "Email is required";
      isValid = false;
    } else if (!emailRegex.test(email)) {
      document.getElementById("emailError").textContent = "Invalid email format";
      isValid = false;
    }

    if (category === "") {
      document.getElementById("categoryError").textContent = "Select a category";
      isValid = false;
    }

    // numeric check for rating
    if (!selectedRating || selectedRating === 0) {
      document.getElementById("ratingError").textContent = "Please select a rating";
      isValid = false;
    }

    if (feedbackText.length < 30) {
      document.getElementById("feedbackError").textContent =
        "Feedback must be at least 30 characters";
      isValid = false;
    }

    if (isValid) {
      const data = { name, email, category, rating: selectedRating, feedback: feedbackText };
      localStorage.setItem("feedbackData", JSON.stringify(data));

      alertContainer.innerHTML = `
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          Thank you for your feedback!
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      `;
      form.reset();
      selectedRating = 0;
      stars.forEach((s) => s.classList.remove("active"));
      charCount.textContent = "0 / 500";
    } else {
      alertContainer.innerHTML = `
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          Please correct the errors above and try again.
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      `;
    }
  });
</script>

</body>
</html>
